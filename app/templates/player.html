{% extends "base.html" %}
{% block content %}
<div class="container mx-auto mt-6 flex flex-col items-center">
    
    <div class="w-full max-w-6xl flex justify-between items-center mb-4 bg-gray-800 p-4 rounded-t-lg border-b border-red-600">
        <h2 class="text-xl font-bold text-white truncate max-w-md">{{ item.name }}</h2>
        <a href="/dashboard?folder_id={{ item.parent_id if item.parent_id else '' }}" class="text-gray-400 hover:text-white transition">
            <i class="fas fa-times text-xl"></i> Close
        </a>
    </div>

    <div class="w-full max-w-6xl bg-black rounded-b-lg shadow-2xl overflow-hidden border border-gray-700 flex justify-center items-center min-h-[500px] relative">
        
        {% if "video" in item.mime_type or item.name.lower().endswith(('.mp4', '.mkv', '.webm', '.mov', '.avi')) %}
            <video controls autoplay class="w-full max-h-[80vh] outline-none">
                <source src="{{ stream_url }}" type="video/mp4">
                Your browser does not support the video tag.
            </video>

        {% elif "image" in item.mime_type or item.name.lower().endswith(('.jpg', '.jpeg', '.png', '.gif', '.webp')) %}
            <img src="{{ stream_url }}" alt="{{ item.name }}" class="max-w-full max-h-[80vh] object-contain">

        {% elif "audio" in item.mime_type or item.name.lower().endswith(('.mp3', '.wav', '.ogg', '.m4a')) %}
            <div class="p-10 text-center">
                <i class="fas fa-music text-6xl text-red-500 mb-6 animate-pulse"></i>
                <audio controls autoplay class="w-96">
                    <source src="{{ stream_url }}" type="audio/mpeg">
                </audio>
            </div>

        {% elif "text" in item.mime_type or "json" in item.mime_type or "xml" in item.mime_type or item.name.lower().endswith(('.txt', '.py', '.js', '.html', '.css', '.json', '.md')) %}
            <div class="w-full h-[600px] bg-gray-900 text-gray-200 p-0 overflow-hidden font-mono text-sm">
                <iframe src="{{ stream_url }}" class="w-full h-full border-none bg-white"></iframe>
            </div>

        {% else %}
            <div class="text-center p-10">
                <i class="fas fa-file-invoice text-6xl text-gray-500 mb-4"></i>
                <p class="text-xl text-gray-400">Preview not available for this type.</p>
                <p class="text-sm text-gray-600 mb-4">Detected Type: {{ item.mime_type }}</p>
                <a href="{{ stream_url }}" class="mt-4 inline-block bg-red-600 text-white px-6 py-2 rounded hover:bg-red-500">
                    Download File
                </a>
            </div>
        {% endif %}
    </div>

    <div class="w-full max-w-6xl mt-4 bg-gray-800 p-6 rounded-lg text-gray-400 text-sm flex justify-between items-center">
        <div>
            <span class="mr-4"><i class="fas fa-hdd mr-2"></i> Size: {{ item.formatted_size }}</span>
            <span><i class="fas fa-clock mr-2"></i> Uploaded: {{ item.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
        </div>
        <a href="{{ stream_url }}" download="{{ item.name }}" class="bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded font-bold transition">
            <i class="fas fa-download mr-1"></i> Download
        </a>
    </div>
</div>
{% endblock %}